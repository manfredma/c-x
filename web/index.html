<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KV å­˜å‚¨æœåŠ¡å™¨æµ‹è¯•é¡µé¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 40px;
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            border: 2px solid #f0f0f0;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .section:hover {
            border-color: #4facfe;
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.1);
        }

        .section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5em;
            display: flex;
            align-items: center;
        }

        .section h2::before {
            content: '';
            width: 4px;
            height: 20px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            margin-right: 10px;
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
        }

        input[type="text"], textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input[type="text"]:focus, textarea:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(79, 172, 254, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a52 100%);
        }

        .btn-danger:hover {
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }

        .result {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 13px;
            line-height: 1.5;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .result.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }

        .result.error {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }

        .result.info {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
        }

        .server-status {
            text-align: center;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 10px;
            font-weight: 500;
        }

        .server-status.online {
            background: #d4edda;
            color: #155724;
            border: 2px solid #c3e6cb;
        }

        .server-status.offline {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .status-indicator {
            display: inline-block;
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 8px;
        }

        .status-indicator.online {
            background: #28a745;
            animation: pulse 2s infinite;
        }

        .status-indicator.offline {
            background: #dc3545;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .quick-test {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .quick-test .btn {
            margin: 0;
            padding: 15px;
            text-align: center;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.9em;
            min-width: auto;
        }

        input[type="number"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e1e1e1;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #4facfe;
            box-shadow: 0 0 0 3px rgba(79, 172, 254, 0.1);
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .content {
                padding: 20px;
            }

            .header {
                padding: 20px;
            }

            .header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ KV å­˜å‚¨æœåŠ¡å™¨</h1>
            <p>åŸºäº kqueue çš„é«˜æ€§èƒ½å†…å­˜é”®å€¼å­˜å‚¨æœåŠ¡æµ‹è¯•é¡µé¢</p>
        </div>

        <div class="content">
            <!-- æœåŠ¡å™¨é…ç½® -->
            <div class="section">
                <h2>âš™ï¸ æœåŠ¡å™¨é…ç½®</h2>
                <div style="display: flex; gap: 15px; align-items: end; flex-wrap: wrap;">
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="serverHost">æœåŠ¡å™¨åœ°å€:</label>
                        <input type="text" id="serverHost" value="localhost" placeholder="localhost" style="width: 120px;">
                    </div>
                    <div class="form-group" style="margin-bottom: 0;">
                        <label for="serverPort">ç«¯å£:</label>
                        <input type="number" id="serverPort" value="8080" placeholder="8080" min="1" max="65535" style="width: 80px;">
                    </div>
                    <button class="btn btn-small" onclick="updateServerConfig()">æ›´æ–°é…ç½®</button>
                    <button class="btn btn-small" onclick="autoDetectPort()">è‡ªåŠ¨æ£€æµ‹</button>
                </div>
            </div>

            <!-- æœåŠ¡å™¨çŠ¶æ€ -->
            <div id="serverStatus" class="server-status offline">
                <span class="status-indicator offline"></span>
                æ­£åœ¨æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€...
            </div>

            <!-- å¿«é€Ÿæµ‹è¯• -->
            <div class="section">
                <h2>ğŸ¯ å¿«é€Ÿæµ‹è¯•</h2>
                <p style="margin-bottom: 20px; color: #666;">ç‚¹å‡»ä¸‹é¢çš„æŒ‰é’®è¿›è¡Œå¿«é€ŸåŠŸèƒ½æµ‹è¯•</p>
                <div class="quick-test">
                    <button class="btn" onclick="quickTest('set')">è®¾ç½®æµ‹è¯•æ•°æ®</button>
                    <button class="btn" onclick="quickTest('get')">è·å–æµ‹è¯•æ•°æ®</button>
                    <button class="btn btn-danger" onclick="quickTest('delete')">åˆ é™¤æµ‹è¯•æ•°æ®</button>
                    <button class="btn" onclick="quickTest('all')">å®Œæ•´æµ‹è¯•æµç¨‹</button>
                </div>
                <div id="quickTestResult" class="result" style="display: none;"></div>
            </div>

            <!-- SET æ“ä½œ -->
            <div class="section">
                <h2>ğŸ“ è®¾ç½®é”®å€¼å¯¹ (POST)</h2>
                <div class="form-group">
                    <label for="setKey">é”® (Key):</label>
                    <input type="text" id="setKey" placeholder="ä¾‹å¦‚: user:123" value="test_key">
                </div>
                <div class="form-group">
                    <label for="setValue">å€¼ (Value):</label>
                    <textarea id="setValue" placeholder="ä¾‹å¦‚: Hello World">Hello, KV Store!</textarea>
                </div>
                <button class="btn" onclick="setKeyValue()">è®¾ç½®é”®å€¼å¯¹</button>
                <div id="setResult" class="result" style="display: none;"></div>
            </div>

            <!-- GET æ“ä½œ -->
            <div class="section">
                <h2>ğŸ” è·å–é”®å€¼ (GET)</h2>
                <div class="form-group">
                    <label for="getKey">é”® (Key):</label>
                    <input type="text" id="getKey" placeholder="ä¾‹å¦‚: user:123" value="test_key">
                </div>
                <button class="btn" onclick="getKeyValue()">è·å–é”®å€¼</button>
                <div id="getResult" class="result" style="display: none;"></div>
            </div>

            <!-- DELETE æ“ä½œ -->
            <div class="section">
                <h2>ğŸ—‘ï¸ åˆ é™¤é”®å€¼å¯¹ (DELETE)</h2>
                <div class="form-group">
                    <label for="deleteKey">é”® (Key):</label>
                    <input type="text" id="deleteKey" placeholder="ä¾‹å¦‚: user:123" value="test_key">
                </div>
                <button class="btn btn-danger" onclick="deleteKeyValue()">åˆ é™¤é”®å€¼å¯¹</button>
                <div id="deleteResult" class="result" style="display: none;"></div>
            </div>

            <!-- æ‰¹é‡æµ‹è¯• -->
            <div class="section">
                <h2>âš¡ æ‰¹é‡æµ‹è¯•</h2>
                <p style="margin-bottom: 20px; color: #666;">æµ‹è¯•å¤šä¸ªé”®å€¼å¯¹çš„æ“ä½œ</p>
                <button class="btn" onclick="batchTest()">å¼€å§‹æ‰¹é‡æµ‹è¯•</button>
                <div id="batchResult" class="result" style="display: none;"></div>
            </div>
        </div>
    </div>

        <script>
        // åŠ¨æ€æœåŠ¡å™¨é…ç½®
        let currentServerHost = 'localhost';
        let currentServerPort = 8080;
        let SERVER_URL = `http://${currentServerHost}:${currentServerPort}`;
        let API_URL = SERVER_URL + '/api';

        // æ›´æ–°æœåŠ¡å™¨é…ç½®
        function updateServerConfig() {
            const host = document.getElementById('serverHost').value.trim() || 'localhost';
            const port = parseInt(document.getElementById('serverPort').value) || 8080;

            if (port < 1 || port > 65535) {
                alert('ç«¯å£å·å¿…é¡»åœ¨ 1-65535 ä¹‹é—´');
                return;
            }

            currentServerHost = host;
            currentServerPort = port;
            SERVER_URL = `http://${currentServerHost}:${currentServerPort}`;
            API_URL = SERVER_URL + '/api';

            // ç«‹å³æ£€æŸ¥æ–°é…ç½®çš„æœåŠ¡å™¨çŠ¶æ€
            checkServerStatus();

            // ä¿å­˜é…ç½®åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('kv_server_host', host);
            localStorage.setItem('kv_server_port', port.toString());
        }

        // è‡ªåŠ¨æ£€æµ‹ç«¯å£
        async function autoDetectPort() {
            const host = document.getElementById('serverHost').value.trim() || 'localhost';
            const commonPorts = [8080, 3000, 8000, 9000, 8888, 5000, 8081, 8082];
            const statusDiv = document.getElementById('serverStatus');

            statusDiv.innerHTML = '<span class="status-indicator offline"></span>æ­£åœ¨è‡ªåŠ¨æ£€æµ‹ç«¯å£...';

            for (const port of commonPorts) {
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 1000);

                    const response = await fetch(`http://${host}:${port}/health`, {
                        method: 'GET',
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);

                    if (response.ok) {
                        document.getElementById('serverPort').value = port;
                        updateServerConfig();
                        return;
                    }
                } catch (error) {
                    // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªç«¯å£
                }
            }

            statusDiv.innerHTML = '<span class="status-indicator offline"></span>æœªæ‰¾åˆ°è¿è¡Œä¸­çš„æœåŠ¡å™¨';
        }

        // é¡µé¢åŠ è½½æ—¶æ¢å¤ä¿å­˜çš„é…ç½®
        function loadSavedConfig() {
            const savedHost = localStorage.getItem('kv_server_host');
            const savedPort = localStorage.getItem('kv_server_port');

            if (savedHost) {
                document.getElementById('serverHost').value = savedHost;
                currentServerHost = savedHost;
            }

            if (savedPort) {
                const port = parseInt(savedPort);
                if (port >= 1 && port <= 65535) {
                    document.getElementById('serverPort').value = port;
                    currentServerPort = port;
                }
            }

            SERVER_URL = `http://${currentServerHost}:${currentServerPort}`;
            API_URL = SERVER_URL + '/api';
        }

        // æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
        async function checkServerStatus() {
            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 3000);

                const response = await fetch(`${SERVER_URL}/health`, {
                    method: 'GET',
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                if (response.ok) {
                    updateServerStatus(true);
                } else {
                    updateServerStatus(false);
                }
            } catch (error) {
                // å¦‚æœ /health å¤±è´¥ï¼Œå°è¯• /test_connection
                try {
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 3000);

                    const response = await fetch(`${SERVER_URL}/test_connection`, {
                        method: 'GET',
                        signal: controller.signal
                    });

                    clearTimeout(timeoutId);

                    if (response.ok) {
                        updateServerStatus(true);
                    } else {
                        updateServerStatus(false);
                    }
                } catch (e) {
                    updateServerStatus(false);
                }
            }
        }

        function updateServerStatus(isOnline) {
            const statusElement = document.getElementById('serverStatus');
            const indicator = statusElement.querySelector('.status-indicator');

            if (isOnline) {
                statusElement.className = 'server-status online';
                indicator.className = 'status-indicator online';
                statusElement.innerHTML = `<span class="status-indicator online"></span>æœåŠ¡å™¨åœ¨çº¿ (${currentServerHost}:${currentServerPort})`;
            } else {
                statusElement.className = 'server-status offline';
                indicator.className = 'status-indicator offline';
                statusElement.innerHTML = `<span class="status-indicator offline"></span>æœåŠ¡å™¨ç¦»çº¿ (${currentServerHost}:${currentServerPort}) - è¯·ç¡®ä¿æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ`;
            }
        }

        // è®¾ç½®é”®å€¼å¯¹
        async function setKeyValue() {
            const key = document.getElementById('setKey').value.trim();
            const value = document.getElementById('setValue').value;
            const resultDiv = document.getElementById('setResult');

            if (!key) {
                showResult(resultDiv, 'è¯·è¾“å…¥é”®å', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/${encodeURIComponent(key)}`, {
                    method: 'POST',
                    body: value,
                    headers: {
                        'Content-Type': 'text/plain'
                    }
                });

                const responseText = await response.text();
                const statusText = `HTTP ${response.status} ${response.statusText}`;

                if (response.ok) {
                    showResult(resultDiv, `âœ… è®¾ç½®æˆåŠŸ!\nçŠ¶æ€: ${statusText}\nå“åº”: ${responseText}`, 'success');
                } else {
                    showResult(resultDiv, `âŒ è®¾ç½®å¤±è´¥!\nçŠ¶æ€: ${statusText}\né”™è¯¯: ${responseText}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // è·å–é”®å€¼
        async function getKeyValue() {
            const key = document.getElementById('getKey').value.trim();
            const resultDiv = document.getElementById('getResult');

            if (!key) {
                showResult(resultDiv, 'è¯·è¾“å…¥é”®å', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/${encodeURIComponent(key)}`);
                const responseText = await response.text();
                const statusText = `HTTP ${response.status} ${response.statusText}`;

                if (response.ok) {
                    showResult(resultDiv, `âœ… è·å–æˆåŠŸ!\nçŠ¶æ€: ${statusText}\nå€¼: ${responseText}`, 'success');
                } else {
                    showResult(resultDiv, `âŒ è·å–å¤±è´¥!\nçŠ¶æ€: ${statusText}\né”™è¯¯: ${responseText}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // åˆ é™¤é”®å€¼å¯¹
        async function deleteKeyValue() {
            const key = document.getElementById('deleteKey').value.trim();
            const resultDiv = document.getElementById('deleteResult');

            if (!key) {
                showResult(resultDiv, 'è¯·è¾“å…¥é”®å', 'error');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/${encodeURIComponent(key)}`, {
                    method: 'DELETE'
                });

                const responseText = await response.text();
                const statusText = `HTTP ${response.status} ${response.statusText}`;

                if (response.ok || response.status === 204) {
                    showResult(resultDiv, `âœ… åˆ é™¤æˆåŠŸ!\nçŠ¶æ€: ${statusText}`, 'success');
                } else {
                    showResult(resultDiv, `âŒ åˆ é™¤å¤±è´¥!\nçŠ¶æ€: ${statusText}\né”™è¯¯: ${responseText}`, 'error');
                }
            } catch (error) {
                showResult(resultDiv, `âŒ ç½‘ç»œé”™è¯¯: ${error.message}`, 'error');
            }
        }

        // å¿«é€Ÿæµ‹è¯•
        async function quickTest(type) {
            const resultDiv = document.getElementById('quickTestResult');
            const testKey = 'quick_test_key';
            const testValue = 'Quick test value - ' + new Date().toLocaleString();

            try {
                switch (type) {
                    case 'set':
                        const setResponse = await fetch(`${API_URL}/${testKey}`, {
                            method: 'POST',
                            body: testValue
                        });
                        const setResult = await setResponse.text();
                        showResult(resultDiv, `ğŸš€ å¿«é€Ÿè®¾ç½®æµ‹è¯•\nçŠ¶æ€: HTTP ${setResponse.status}\nå“åº”: ${setResult}`, setResponse.ok ? 'success' : 'error');
                        break;

                    case 'get':
                        const getResponse = await fetch(`${API_URL}/${testKey}`);
                        const getValue = await getResponse.text();
                        showResult(resultDiv, `ğŸ” å¿«é€Ÿè·å–æµ‹è¯•\nçŠ¶æ€: HTTP ${getResponse.status}\nå€¼: ${getValue}`, getResponse.ok ? 'success' : 'error');
                        break;

                    case 'delete':
                        const deleteResponse = await fetch(`${API_URL}/${testKey}`, {
                            method: 'DELETE'
                        });
                        const deleteResult = await deleteResponse.text();
                        showResult(resultDiv, `ğŸ—‘ï¸ å¿«é€Ÿåˆ é™¤æµ‹è¯•\nçŠ¶æ€: HTTP ${deleteResponse.status}\nå“åº”: ${deleteResult}`, (deleteResponse.ok || deleteResponse.status === 204) ? 'success' : 'error');
                        break;

                    case 'all':
                        let allResults = 'ğŸ¯ å®Œæ•´æµ‹è¯•æµç¨‹:\n\n';

                        // 1. è®¾ç½®
                        const setResp = await fetch(`${API_URL}/${testKey}`, {
                            method: 'POST',
                            body: testValue
                        });
                        allResults += `1. è®¾ç½®é”®å€¼å¯¹: HTTP ${setResp.status} - ${setResp.ok ? 'âœ…' : 'âŒ'}\n`;

                        // 2. è·å–
                        const getResp = await fetch(`${API_URL}/${testKey}`);
                        const gotValue = await getResp.text();
                        allResults += `2. è·å–é”®å€¼: HTTP ${getResp.status} - ${getResp.ok ? 'âœ…' : 'âŒ'}\n`;
                        if (getResp.ok) {
                            allResults += `   è·å–çš„å€¼: ${gotValue}\n`;
                        }

                        // 3. åˆ é™¤
                        const delResp = await fetch(`${API_URL}/${testKey}`, {
                            method: 'DELETE'
                        });
                        allResults += `3. åˆ é™¤é”®å€¼å¯¹: HTTP ${delResp.status} - ${(delResp.ok || delResp.status === 204) ? 'âœ…' : 'âŒ'}\n`;

                        // 4. éªŒè¯åˆ é™¤
                        const verifyResp = await fetch(`${API_URL}/${testKey}`);
                        allResults += `4. éªŒè¯åˆ é™¤: HTTP ${verifyResp.status} - ${verifyResp.status === 404 ? 'âœ…' : 'âŒ'}\n`;

                        const allSuccess = setResp.ok && getResp.ok && (delResp.ok || delResp.status === 204) && verifyResp.status === 404;
                        showResult(resultDiv, allResults, allSuccess ? 'success' : 'error');
                        break;
                }
            } catch (error) {
                showResult(resultDiv, `âŒ å¿«é€Ÿæµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ‰¹é‡æµ‹è¯•
        async function batchTest() {
            const resultDiv = document.getElementById('batchResult');
            const testData = [
                { key: 'user:1', value: 'Alice' },
                { key: 'user:2', value: 'Bob' },
                { key: 'config:timeout', value: '30' },
                { key: 'config:retries', value: '3' },
                { key: 'ä¸­æ–‡é”®', value: 'ä¸­æ–‡å€¼' }
            ];

            let results = 'âš¡ æ‰¹é‡æµ‹è¯•ç»“æœ:\n\n';
            let successCount = 0;
            let totalOperations = testData.length * 3; // set, get, delete for each

            try {
                for (let i = 0; i < testData.length; i++) {
                    const { key, value } = testData[i];
                    results += `æµ‹è¯• ${i + 1}: ${key}\n`;

                    // è®¾ç½®
                    try {
                        const setResp = await fetch(`${API_URL}/${encodeURIComponent(key)}`, {
                            method: 'POST',
                            body: value
                        });
                        results += `  è®¾ç½®: HTTP ${setResp.status} ${setResp.ok ? 'âœ…' : 'âŒ'}\n`;
                        if (setResp.ok) successCount++;
                    } catch (e) {
                        results += `  è®¾ç½®: é”™è¯¯ âŒ\n`;
                    }

                    // è·å–
                    try {
                        const getResp = await fetch(`${API_URL}/${encodeURIComponent(key)}`);
                        const gotValue = await getResp.text();
                        results += `  è·å–: HTTP ${getResp.status} ${getResp.ok ? 'âœ…' : 'âŒ'}`;
                        if (getResp.ok) {
                            results += ` (${gotValue === value ? 'å€¼åŒ¹é…' : 'å€¼ä¸åŒ¹é…'})`;
                            if (gotValue === value) successCount++;
                        }
                        results += '\n';
                    } catch (e) {
                        results += `  è·å–: é”™è¯¯ âŒ\n`;
                    }

                    // åˆ é™¤
                    try {
                        const delResp = await fetch(`${API_URL}/${encodeURIComponent(key)}`, {
                            method: 'DELETE'
                        });
                        results += `  åˆ é™¤: HTTP ${delResp.status} ${(delResp.ok || delResp.status === 204) ? 'âœ…' : 'âŒ'}\n`;
                        if (delResp.ok || delResp.status === 204) successCount++;
                    } catch (e) {
                        results += `  åˆ é™¤: é”™è¯¯ âŒ\n`;
                    }

                    results += '\n';
                }

                results += `æ€»ç»“: ${successCount}/${totalOperations} æ“ä½œæˆåŠŸ (${Math.round(successCount/totalOperations*100)}%)`;
                showResult(resultDiv, results, successCount === totalOperations ? 'success' : 'info');

            } catch (error) {
                showResult(resultDiv, `âŒ æ‰¹é‡æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(element, message, type) {
            element.textContent = message;
            element.className = `result ${type}`;
            element.style.display = 'block';
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // åŠ è½½ä¿å­˜çš„é…ç½®
            loadSavedConfig();
            // æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€
            checkServerStatus();
            // æ¯30ç§’æ£€æŸ¥ä¸€æ¬¡æœåŠ¡å™¨çŠ¶æ€
            setInterval(checkServerStatus, 30000);
        });
    </script>
</body>
</html>

